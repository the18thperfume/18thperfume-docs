# Test Design: Story 1.2 - Quản lý Sản phẩm và Biến thể cho Admin

Date: 22/09/2025
Designer: Quinn (Test Architect)

## Test Strategy Overview

- **Total test scenarios**: 47
- **Unit tests**: 20 (43%)
- **Integration tests**: 19 (40%)
- **E2E tests**: 8 (17%)
- **Priority distribution**: P0: 15, P1: 18, P2: 12, P3: 2

## Test Scenarios by Acceptance Criteria

### AC1: Product Form với các trường chi tiết

#### Form Field Validation Tests

| ID           | Level       | Priority | Test                           | Justification                    |
|--------------|-------------|----------|--------------------------------|----------------------------------|
| 1.2-UNIT-001 | Unit        | P0       | Validate product name required | Critical business data          |
| 1.2-UNIT-002 | Unit        | P0       | Validate brand field format    | Essential product attribute     |
| 1.2-UNIT-003 | Unit        | P0       | Validate release year range    | Data integrity for year field   |
| 1.2-UNIT-004 | Unit        | P1       | Validate text field max length | Prevent database overflow       |
| 1.2-UNIT-005 | Unit        | P1       | Validate gender dropdown enum  | Business rule enforcement       |
| 1.2-UNIT-006 | Unit        | P1       | Validate segment dropdown enum | Business rule enforcement       |
| 1.2-UNIT-007 | Unit        | P2       | Validate notes comma parsing   | Data format correctness         |

#### Form Component Tests

| ID           | Level       | Priority | Test                              | Justification                 |
|--------------|-------------|----------|-----------------------------------|-------------------------------|
| 1.2-INT-001  | Integration | P0       | Product form submission flow      | Critical admin workflow       |
| 1.2-INT-002  | Integration | P1       | Form validation error display     | User experience critical      |
| 1.2-INT-003  | Integration | P1       | Dropdown population from API      | Dynamic data dependency       |
| 1.2-INT-004  | Integration | P2       | Form reset functionality          | Admin convenience feature     |
| 1.2-E2E-001  | E2E         | P0       | Admin creates new product         | Revenue-critical admin flow   |
| 1.2-E2E-002  | E2E         | P1       | Admin edits existing product      | Core admin functionality      |

### AC2: Auto-generated Ingredients Field

#### Ingredients Logic Tests

| ID           | Level       | Priority | Test                                | Justification                   |
|--------------|-------------|----------|-------------------------------------|---------------------------------|
| 1.2-UNIT-008 | Unit        | P0       | Combine top/middle/base notes       | Critical business logic         |
| 1.2-UNIT-009 | Unit        | P0       | Handle empty notes gracefully      | Edge case handling              |
| 1.2-UNIT-010 | Unit        | P1       | Remove duplicate ingredients        | Data quality improvement        |
| 1.2-UNIT-011 | Unit        | P1       | Maintain ingredient order priority  | Business rule compliance        |
| 1.2-UNIT-012 | Unit        | P2       | Handle special characters in notes  | Data format robustness          |

#### Integration Tests

| ID           | Level       | Priority | Test                                    | Justification                 |
|--------------|-------------|----------|-----------------------------------------|-------------------------------|
| 1.2-INT-005  | Integration | P0       | Ingredients auto-update on notes change | Critical feature integration  |
| 1.2-INT-006  | Integration | P1       | Ingredients persist correctly to DB     | Data integrity validation     |

### AC3: Variant Management Section

#### Variant CRUD Operations

| ID           | Level       | Priority | Test                              | Justification                    |
|--------------|-------------|----------|-----------------------------------|----------------------------------|
| 1.2-UNIT-013 | Unit        | P0       | Validate variant name required    | Essential variant data           |
| 1.2-UNIT-014 | Unit        | P0       | Validate price numeric format     | Financial data integrity         |
| 1.2-UNIT-015 | Unit        | P0       | Validate sale percentage range    | Business rule (0-100%)          |
| 1.2-UNIT-016 | Unit        | P1       | Calculate final price correctly   | Revenue calculation accuracy     |
| 1.2-INT-007  | Integration | P0       | Add new variant to product        | Core admin functionality         |
| 1.2-INT-008  | Integration | P0       | Update existing variant           | Admin workflow essential         |
| 1.2-INT-009  | Integration | P0       | Delete variant from product       | Admin data management            |
| 1.2-INT-010  | Integration | P1       | Validate variant uniqueness       | Data consistency rules           |

#### Variant Management UI

| ID           | Level       | Priority | Test                                 | Justification                |
|--------------|-------------|----------|--------------------------------------|------------------------------|
| 1.2-E2E-003  | E2E         | P1       | Admin manages multiple variants      | Complex admin workflow       |
| 1.2-E2E-004  | E2E         | P2       | Variant form validation errors       | User experience validation   |

### AC4: Auto-extract Capacity from Variant Name

#### Capacity Extraction Logic

| ID           | Level       | Priority | Test                                  | Justification                  |
|--------------|-------------|----------|---------------------------------------|--------------------------------|
| 1.2-UNIT-017 | Unit        | P0       | Extract "Chiết" from variant name    | Critical business logic        |
| 1.2-UNIT-018 | Unit        | P0       | Extract "Fullseal" from variant name | Critical business logic        |
| 1.2-UNIT-019 | Unit        | P1       | Handle multiple capacity patterns     | Robust pattern matching        |
| 1.2-UNIT-020 | Unit        | P1       | Default capacity when extraction fails| Graceful degradation          |
| 1.2-INT-011  | Integration | P0       | Capacity saves correctly to database  | Data integrity essential       |
| 1.2-INT-012  | Integration | P1       | Capacity updates on name change       | Dynamic field behavior         |

### AC5: Database Persistence

#### Data Persistence Tests

| ID           | Level       | Priority | Test                                    | Justification                |
|--------------|-------------|----------|-----------------------------------------|------------------------------|
| 1.2-INT-013  | Integration | P0       | Product creation persists all fields   | Data integrity critical      |
| 1.2-INT-014  | Integration | P0       | Product update persists changes         | Data consistency essential   |
| 1.2-INT-015  | Integration | P0       | Variant data persists with product     | Relational data integrity    |
| 1.2-INT-016  | Integration | P1       | Database transaction rollback on error | Error handling robustness    |
| 1.2-INT-017  | Integration | P1       | Concurrent product modifications        | Data race condition handling |
| 1.2-INT-018  | Integration | P2       | Product retrieval for admin editing    | Admin workflow support       |

#### API Endpoint Tests

| ID           | Level       | Priority | Test                                  | Justification                  |
|--------------|-------------|----------|---------------------------------------|--------------------------------|
| 1.2-INT-019  | Integration | P0       | POST /admin/products creates product  | API contract critical         |
| 1.2-E2E-005  | E2E         | P0       | PUT /admin/products updates product   | API contract essential        |
| 1.2-E2E-006  | E2E         | P1       | GET /admin/products retrieves product | Admin workflow dependency     |

## Cross-Cutting Concern Tests

### Security Tests

| ID           | Level       | Priority | Test                                | Justification                    |
|--------------|-------------|----------|-------------------------------------|----------------------------------|
| 1.2-INT-020  | Integration | P0       | Admin authentication required       | Security critical                |
| 1.2-E2E-007  | E2E         | P0       | Unauthorized access blocked         | Security validation essential    |

### Performance Tests

| ID           | Level       | Priority | Test                                | Justification                    |
|--------------|-------------|----------|-------------------------------------|----------------------------------|
| 1.2-E2E-008  | E2E         | P2       | Complex form loads within 2 seconds | User experience requirement      |

## Risk Coverage

Mapping test scenarios to identified risks từ risk profile:

### SEC-001: Admin Authentication Bypass
- **Covered by**: 1.2-INT-020, 1.2-E2E-007
- **Test type**: Security integration và end-to-end

### DATA-001: Data Loss Risk
- **Covered by**: 1.2-INT-013, 1.2-INT-014, 1.2-INT-015, 1.2-INT-016
- **Test type**: Data integrity integration tests

### SEC-002: Input Validation Vulnerabilities
- **Covered by**: 1.2-UNIT-001 through 1.2-UNIT-007, 1.2-INT-002
- **Test type**: Unit validation và integration error handling

### PERF-001: Slow Admin Interface
- **Covered by**: 1.2-E2E-008
- **Test type**: Performance end-to-end test

### DATA-002: Variant Capacity Extraction Failures
- **Covered by**: 1.2-UNIT-017 through 1.2-UNIT-020, 1.2-INT-011, 1.2-INT-012
- **Test type**: Unit logic và integration persistence tests

## Test Data Requirements

### Product Test Data
```yaml
valid_product:
  name: "Chanel No. 5"
  brand: "Chanel"
  category: "Nữ"
  segment: "Designer"
  origin: "France"
  fragranceFamily: "Floral"
  concentration: "Eau de Parfum"
  releaseYear: 1921
  seasons: ["Thu", "Đông"]
  topNotes: ["Bergamot", "Lemon", "Neroli"]
  middleNotes: ["Rose", "Jasmine", "Lily"]
  baseNotes: ["Sandalwood", "Vanilla", "Musk"]
```

### Variant Test Data
```yaml
valid_variants:
  - name: "Chiết 10ml"
    originalPrice: 150000
    salePercentage: 10
  - name: "Fullseal 50ml"
    originalPrice: 800000
    salePercentage: 0
```

### Edge Case Test Data
```yaml
edge_cases:
  empty_notes: []
  special_chars: ["Bergamot & Lemon", "Rose/Jasmine"]
  long_names: "Very long product name exceeding normal limits..."
  negative_prices: -100
  invalid_percentages: 150
```

## Test Environment Requirements

### Unit Test Environment
- **Framework**: Jest
- **Coverage Target**: 95% for business logic
- **Mock Requirements**: None (pure functions)

### Integration Test Environment
- **Database**: In-memory DynamoDB Local
- **API**: Local serverless offline
- **Authentication**: Mock admin tokens

### E2E Test Environment
- **Environment**: Staging
- **Browser**: Chrome, Firefox
- **Test User**: Admin test account
- **Data**: Isolated test dataset

## Recommended Execution Order

### Phase 1: Critical Path (P0)
1. **Unit tests** cho validation logic (1.2-UNIT-001 to 003)
2. **Unit tests** cho ingredients generation (1.2-UNIT-008, 009)
3. **Unit tests** cho capacity extraction (1.2-UNIT-017, 018)
4. **Integration tests** cho database persistence (1.2-INT-013 to 015)

### Phase 2: Core Functionality (P0 + P1)
1. **Integration tests** cho form workflows (1.2-INT-001, 002)
2. **Integration tests** cho variant management (1.2-INT-007 to 009)
3. **E2E tests** cho admin journeys (1.2-E2E-001, 002)

### Phase 3: Secondary Features (P2)
1. **Remaining unit tests** cho edge cases
2. **Performance tests** cho user experience
3. **UI interaction tests** cho admin convenience

### Phase 4: Nice-to-Have (P3)
1. **Advanced edge case testing**
2. **Performance optimization validation**

## Test Maintenance Strategy

### Automated Regression
- **Unit tests**: Run on every commit
- **Integration tests**: Run on PR creation
- **E2E tests**: Run nightly và before releases

### Test Data Management
- **Setup**: Automated test data creation
- **Cleanup**: Automatic cleanup after test suites
- **Isolation**: Each test suite uses isolated data

### Test Documentation
- **Test cases**: Documented với expected outcomes
- **Failure patterns**: Common failure scenarios documented
- **Debugging guides**: Steps để debug failed tests

---

**Test Design Completed by**: Quinn - Test Architect  
**Review Required**: Lead Developer approval cho test strategy  
**Implementation Timeline**: Tests implemented alongside development của story 1.2
